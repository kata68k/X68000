━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

	    MACS data Player「MACSplay.x」v1.02
	    
		                                       2022/05/15 カタ

────────────────────────────────────

● 機能
X68000のMACSデータを再生するプレイヤーです。
特徴として、ハイメモリ環境があれば、ハイメモリを利用して12MBを超える
MACSデータの再生が可能になります。

● 使い方
MACSDRV.xを常駐させた後に、コマンドラインで以下を実行してください。

>MACSplay.x [Option] file

例１
>MACSplay.x -K BadApple.MCS
再生中、キー入力で再生を停止させません。

例２
>MACSplay.x -R0 BadApple.MCS
無限ループで再生させます。

● file
拡張子が.MCSのアニメーションデータです。
※ファイルがMACSデータであるかどうかの判定は実装していません。

● オプション[Option]

-D  パレットを50%暗くする		＜MACSDRVの特殊効果フラグ＞
	
-P  PCMの再生をしない 			＜MACSDRVの特殊効果フラグ＞

-K  キー入力時、終了しない 		＜MACSDRVの特殊効果フラグ＞

-C  アニメ終了時、画面を初期化しない 	＜MACSDRVの特殊効果フラグ＞

-SL MACSDRVがスリープしている時でも再生する ＜MACSDRVの特殊効果フラグ＞

-GR ｸﾞﾗﾌｨｯｸを表示したまま再生する 	＜MACSDRVの特殊効果フラグ＞

-SP ｽﾌﾟﾗｲﾄを表示したまま再生する 	＜MACSDRVの特殊効果フラグ＞

-AD PCM8A.Xの常駐をチェックしない(060turbo.sys -adで再生する場合)

  060turbo.sys -adで再生する場合、PCM8Aの常駐は不要であるため
  このオプション設定があります。

-Rx リピート再生するx=1〜255回、x=0(無限ループ)

  リピート再生有効時、下記オプションの設定を変更します。
  「-K」のオプション設定を強制で無効化します。（キー入力で中断できます）
  「-C」のオプション設定が強制で有効化します。（リピートの継ぎ目を気にしてみました）

● ハイメモリで再生（030機種以降、PhantomX等の030、040、060のエミュレーション可）
  通常メインメモリに載らないサイズのMACSデータは再生できません。
  そこでハイメモリを使うことができないか考えました。
  実現方法は、ハイメモリの実装(IOCS $F8)を判別し、メモリ確保しているだけです。
  ハイメモリ利用の判別は、メインメモリの空きと、MACSデータのファイルサイズを比較します。
  ハイメモリからPCMを再生するには、PCM8Aもしくは、060turbo.sysの機能が
  必要になります。（ハイメモリのアドレスは、DMAの範囲外であるため）

  ・PCM8Aを使う場合
    >PCM8A -w18
    で予め常駐してください。
  
  ・060turbo.sysを使う場合
    060turbo.sysのドライバ組み込み時に -adのオプション設定を行い、
    再生時は、MACSplay.x -AD のオプションを追加ください。

● 040Excel/060Excel機種について
  実力不足でメモリ確保できず、再生できません。（誰か教えて〜

● 8MBオーバーのMACSデータについて
  HLK evolution version 3.01+15以降で作成できるようになります。
  オプション設定 -rを使うことで、CV.Xを使うことなく.r形式の実行ファイルが作れます。

● 用語集（本プログラムに限る）
  ハイメモリ	：16MB以降のメモリ空間（68030以降のMPUに限る）
  メインメモリ	：X68000のSWITCH.Xで設定できる範囲のメモリ空間(12MB)
  
● 履歴
2022/05/15 1.02		040Excel/060Excel非対応（MALLOC3でメモリ確保できませんでした。）
			リファクタリングした。

2022/05/09 1.01a	「ローカルメモリ」の意味を間違っていたので「メインメモリ」に修正した。

2022/05/05 1.01		「メインメモリ」の空き容量の計算が間違っていました。
			アボート時、ADPCMの再生を停止していましたが、
			本プログラム終了時は、必ずADPCMの再生を停止するようにしました。

2022/05/03 1.00		初版
